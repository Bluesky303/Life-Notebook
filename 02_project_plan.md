# AI 管理记事本项目计划书

## 1. 项目目标

- 面向单用户的私有化生活管理系统（任务 + 资产 + 动态 + 知识库）。
- 前后端同仓库，前端采用 Next.js，后端采用 Python FastAPI。
- 数据库采用 PostgreSQL（后续可加 pgvector 支持语义检索）。
- AI 层支持多模型接口，优先本地/可控调用；支持接入 Codex 作为助手能力之一。
- 首阶段不做 Docker 部署，优先本地开发可运行。

## 2. 功能范围拆解（按页面）

### 2.1 首页 Dashboard

- 左上角：总财产（仅统计标记为“现金”的资产），可点击进入资产管理。
- 顶栏：导航到 财产记录 / 任务栏 / 知识库 / 选项。
- 中部：周时间表（块状时间段）。
- 任务自动填入时间表，并显示空闲时间。
- 不同重要性使用不同颜色。
- 下部：动态流（顶部快捷输入 + 分类，支持语音输入；下方最近动态）。

### 2.2 财产记录

- 钱包与资产类型：微信钱包、支付宝钱包、支付宝理财（可扩展）。
- 主页总财产只统计现金型资产。
- 理财记录：投入资产、每日收益（手动输入）。
- 任务提醒：每周一到周五提醒记录理财收益。
- 图表：收益趋势折线图。
- 钱包流水：每日收入/支出 + 分类（吃饭、买书等）。
- 统计：按分类筛选查看；按月收入支出饼图。

### 2.3 任务栏

- 任务信息：标题、说明、分类、重要性、状态、时间规则。
- 时间规则：每天 / 每周 / 每月 / 每年 / 农历每年 / 零散日期段 / 复合规则（某时段内每周等）。
- AI 规划：通过自然语言生成初始任务计划，可再编辑。
- 支持按分类筛选、按重要性颜色展示、便捷修改。

### 2.4 知识库

- 双模式：博客（问题解决过程）+ 词条（类似 wiki）。
- 内容支持 Markdown，基础 LaTeX。
- 支持编辑、检索、按标签/类型查看。

### 2.5 选项

- 模型选择（多接口路由策略）。
- 页面主题（科幻简洁风，后续支持多主题）。
- 其他偏好设置（提醒、默认分类等）。

## 3. 技术方案（首版）

## 3.1 仓库结构建议

```text
ai-life-notebook/
  frontend/                 # Next.js
  backend/                  # FastAPI
  docs/
    requirements.md
    plan.md
```

## 3.2 前端

- Next.js App Router + TypeScript。
- UI 风格：科幻简洁（深色背景、高对比强调色、简洁卡片与线条）。
- 图表：ECharts 或 Recharts。
- 语音输入：Web Speech API（浏览器支持范围内）。

## 3.3 后端

- FastAPI + SQLAlchemy + Alembic。
- 核心模块：
  - auth（单用户可先简化）
  - assets（资产、钱包、流水、收益）
  - tasks（任务与时间规则）
  - feed（动态）
  - knowledge（博客/词条）
  - ai_gateway（模型路由）
- 数据库：PostgreSQL（后续可启用 pgvector）。

## 3.4 AI 多接口

- 抽象统一接口：`POST /ai/chat`、`POST /ai/plan-task`、`POST /ai/parse-record`。
- Provider 设计：`codex` / `openai-compatible` / `local-ollama`。
- 配置来源：后端环境变量 + 选项页可切换默认模型。
- 关键原则：默认不把敏感数据发送到外部模型（需显式允许）。

## 4. 数据模型（首版核心）

- `assets`：资产账户（类型、名称、是否现金、余额）。
- `investment_logs`：理财投入与每日收益。
- `transactions`：收入支出流水（金额、分类、时间、备注、账户）。
- `tasks`：任务基础信息（分类、重要性、状态、开始结束时间）。
- `task_rules`：重复/农历/区间等规则（可 JSON 结构）。
- `timeline_blocks`：排程后的时间块（用于周视图渲染缓存）。
- `feed_records`：动态记录（来源、文本、分类、时间、关联实体）。
- `knowledge_entries`：知识库条目（博客/词条、markdown 内容、标签）。
- `settings`：模型、主题、提醒偏好。

## 5. 执行步骤（建议 4 个阶段）

### 阶段 A：项目初始化（1-2 天）

- 创建 `frontend` 和 `backend`。
- 建立基础路由和数据库连接。
- 建立统一 API 协议与错误格式。

### 阶段 B：首页 + 财产基础（3-5 天）

- 首页框架、顶栏、总财产卡片。
- 财产页面：账户、流水录入、分类统计。
- 月度饼图与收益折线图。

### 阶段 C：任务系统 + 周时间表（4-6 天）

- 任务 CRUD、分类、重要性颜色。
- 周视图时间块渲染与空闲时间计算。
- 周一到周五理财记录提醒任务生成。

### 阶段 D：动态 + 知识库 + 选项 + AI 接入（4-6 天）

- 动态快捷输入与最近动态。
- 知识库（博客/词条、Markdown、基础 LaTeX）。
- 设置页（模型选择、主题）。
- AI 网关接入 Codex Provider（再加可扩展 Provider）。

## 6. 测试计划

### 6.1 后端测试

- 单元测试：任务规则解析、空闲时间计算、资产统计逻辑。
- 接口测试：资产、流水、任务、动态、知识库、AI 网关。
- 数据校验：金额精度、时间区间冲突、重复规则合法性。

### 6.2 前端测试

- 组件测试：时间块渲染、颜色映射、图表数据转换。
- 页面流程测试：首页录入动态 -> 自动分类 -> 展示最近动态。
- 兼容性：语音输入降级策略（不支持浏览器时给出提示）。

### 6.3 联调与验收

- 验收场景 1：新增任务 -> 自动进入周时间表。
- 验收场景 2：新增支出/收入 -> 月度饼图更新。
- 验收场景 3：理财收益录入 -> 折线图可见趋势。
- 验收场景 4：自然语言输入 -> AI 解析为任务或流水草稿。

## 7. 本地运行计划（无 Docker）

- 后端：
  - 创建虚拟环境、安装依赖、配置 `.env`、运行迁移、启动 FastAPI。
- 前端：
  - 安装依赖、配置 API 地址、启动 Next.js。
- 开发约定：
  - 前后端统一时区、统一时间格式（ISO 8601）。
  - 金额统一使用 decimal 存储与传输。

## 8. 风险与对应策略

- 复杂时间规则实现难度高：先实现常用规则，再扩展农历与复合规则。
- AI 输出不稳定：增加结构化 JSON 输出约束与二次校验。
- 数据隐私风险：Provider 分级与显式授权开关。
- 语音输入兼容性：先做浏览器原生方案并提供文本降级。

## 9. 里程碑定义

- M1：首页 + 财产基础 + 可录入流水。
- M2：任务系统 + 周时间表自动排布。
- M3：动态 + 知识库可用。
- M4：AI 多 Provider 跑通（含 Codex 接口）与设置页可切换。

## 10. 近期行动清单

1. 初始化单仓 `frontend` + `backend`。
2. 先落地首页骨架与导航。
3. 实现资产与流水最小闭环（录入 + 统计 + 图表）。
4. 实现任务规则基础版（天/周/月/年）和周视图。
5. 接入 AI 网关（先 `codex` provider，后扩展）。
